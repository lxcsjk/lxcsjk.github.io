<p>è¿™å‡ å¤©åœ¨å†™æ–‡ä»¶ä¸‹è½½ï¼Œæ–­ç‚¹ç»­ä¼ ï¼Œéœ€è¦ç”¨åˆ°FMDBè¿›è¡Œæ•°æ®çš„ç®¡ç†ï¼Œç­‰å†™å®Œä¹Ÿæ€»ç»“ä¸€ä¸‹ã€‚</p>

<p>å…¶å®ä¹Ÿæ˜¯è¿™ä¸¤å¤©æ‰å­¦ä¹  <code class="highlighter-rouge">FMDB</code>ï¼Œgoogleäº†ä¸€ä¸‹èµ„æ–™æœ‰å¾ˆå¤šï¼Œå°±å» github ä¸Šé¢å…ˆ <a href="https://github.com/ccgus/fmdb">Star</a> ä¸€ä¸‹<code class="highlighter-rouge">FMDB</code>ï¼Œå‘ç°ä»–<code class="highlighter-rouge">README.markdown</code>å†™çš„å¾ˆè¯¦ç»†ã€‚ç„¶åä¹Ÿçœ‹äº†å”å·§å¤§ç‰›çš„<a href="http://blog.devtang.com/2012/04/22/use-fmdb/">æŠ€æœ¯åšå®¢</a>ï¼Œå†™äº†<a href="https://github.com/lxcsjk/FMDBDemo">FMDBDemo</a>ç©ç©ã€‚</p>

<hr />

<h3 id="section">é›†æˆåˆ°é¡¹ç›®</h3>

<p>é€šè¿‡ <a href="https://cocoapods.org">CocoaPods</a> æ·»åŠ  <code class="highlighter-rouge">pod 'FMDB'</code> ç„¶å <code class="highlighter-rouge">pod update --verbose --no-repo-update</code> OK~</p>

<hr />

<h3 id="section-1">åˆ›å»ºæ•°æ®åº“</h3>

<p>å¯¼å…¥ <code class="highlighter-rouge">libsqlite3.tbd</code>  (<code class="highlighter-rouge">libsqlite3.0.tbd</code> ä¹Ÿå¯ä»¥)
<img src="http://lxc.xiaocblog.com/QQ20161203-223307@2x.png" alt="" /></p>

<p>å¼•å…¥ <code class="highlighter-rouge">#import "FMDB.h"</code></p>

<h5 id="section-2">åˆ›å»ºæ•°æ®åº“</h5>

<div class="highlighter-rouge"><pre class="highlight"><code>    NSString *doc =[NSSearchPathForDirectoriesInDomains(NSDocumentDirectory,NSUserDomainMask, YES) lastObject];
    
    fileName = [doc stringByAppendingPathComponent:@"downCourse.sqlite"];
    
    DLog(@"sqlæ–‡ä»¶è·¯å¾„ ï¼š %@",fileName);
</code></pre>
</div>

<p>æˆ‘åˆ›å»ºåœ¨<code class="highlighter-rouge">Documents</code>ç›®å½•ä¸‹</p>

<p>å…³äºåˆ›å»ºæ•°æ®åº“ï¼š</p>

<blockquote>
  <p>An <code class="highlighter-rouge">FMDatabase</code> is created with a path to a SQLite database file. This path can be one of these three:</p>
</blockquote>

<blockquote>
  <ol>
    <li>A file system path. The file does not have to exist on disk. If it does not exist, it is created for you.</li>
  </ol>
</blockquote>

<blockquote>
  <ol>
    <li>An empty string (@â€â€). An empty database is created at a temporary location. This database is deleted with the <code class="highlighter-rouge">FMDatabase</code> connection is closed.</li>
  </ol>
</blockquote>

<blockquote>
  <ol>
    <li><code class="highlighter-rouge">NULL</code>. An in-memory database is created. This database will be destroyed with the FMDatabase connection is closed.</li>
  </ol>
</blockquote>

<p>æ„æ€å°±æ˜¯</p>

<blockquote>
  <p>å»ºç«‹æ•°æ®åº“åªéœ€è¦å¦‚ä¸‹ä¸€è¡Œå³å¯ , å½“è¯¥æ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼Œfmdb ä¼šè‡ªå·±åˆ›å»ºä¸€ä¸ªã€‚å¦‚æœä½ ä¼ å…¥çš„å‚æ•°æ˜¯ç©ºä¸²ï¼š@â€â€ ï¼Œåˆ™ fmdb ä¼šåœ¨ä¸´æ—¶æ–‡ä»¶ç›®å½•ä¸‹åˆ›å»ºè¿™ä¸ªæ•°æ®åº“ï¼Œå¦‚æœä½ ä¼ å…¥çš„å‚æ•°æ˜¯ NULLï¼Œåˆ™å®ƒä¼šå»ºç«‹ä¸€ä¸ªåœ¨å†…å­˜ä¸­çš„æ•°æ®åº“ã€‚</p>
</blockquote>

<hr />

<h3 id="section-3">æ‰“å¼€æ•°æ®åº“</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>    FMDatabase *db = [FMDatabase databaseWithPath:fileName];
    if ([db open]){
    	// sql
    }
    [db close];
</code></pre>
</div>

<p>å°±å¯ä»¥äº† æ‰§è¡Œå®Œ æ³¨æ„ä¸€å®šè¦ <code class="highlighter-rouge">[db close]</code> å…³é—­æ•°æ®åº“</p>

<hr />

<h3 id="section-4">åˆ›å»ºè¡¨</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>-(void)createTable{
    //    NSFileManager * fileManager = [NSFileManager defaultManager];
    //    if ([fileManager fileExistsAtPath:fileName] == NO) {
    if (!isTableExist) {
        FMDatabase *db = [FMDatabase databaseWithPath:fileName];
        if ([db open]){
            //  åˆ›å»ºè¡¨
            BOOL result = [db executeUpdate:@"CREATE TABLE 't_down_course' ('id' INTEGER PRIMARY KEY AUTOINCREMENT  NOT NULL , 'courseId' INTEGER, 'downPath' VARCHAR(255),'courseInfo' text)"];
            if (result){
                DLog(@"åˆ›å»ºè¡¨æˆåŠŸ");
                isTableExist = YES;
                [self showAlertWithMessage:@"åˆ›å»ºè¡¨ --- æˆåŠŸ" completion:nil];
            }else{
                [self showAlertWithMessage:@"åˆ›å»ºè¡¨ --- å¤±è´¥" completion:nil];
            }
            [db close];
        }else{
            [self showAlertWithMessage:@"æ‰“å¼€æ•°æ®åº“ --- å¤±è´¥" completion:nil];
        }
    }
    //    }
}
</code></pre>
</div>

<p>åˆ›å»ºåç§°ä¸º <code class="highlighter-rouge">t_down_course</code> çš„è¡¨</p>

<h5 id="section-5">å¯¹è¡¨çš„å±æ€§æ€åˆ æ”¹</h5>

<p>è¯­æ³•:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>BOOL result = [db executeUpdate:sql]
</code></pre>
</div>

<ol>
  <li>
    <p>å¦‚éœ€åœ¨è¡¨ä¸­æ·»åŠ åˆ—ï¼Œè¯·ä½¿ç”¨ä¸‹åˆ—è¯­æ³•:</p>

    <p><code class="highlighter-rouge">
 ALTER TABLE table_name ADD column_name datatype
</code></p>
  </li>
  <li>
    <p>è¦åˆ é™¤è¡¨ä¸­çš„åˆ—ï¼Œè¯·ä½¿ç”¨ä¸‹åˆ—è¯­æ³•:</p>

    <p><code class="highlighter-rouge">
 ALTER TABLE table_name DROP COLUMN column_name
</code></p>
  </li>
  <li>
    <p>æ›´æ–°è¡¨ä¸­åˆ—çš„å±æ€§ï¼Œè¯·ä½¿ç”¨ä¸‹åˆ—è¯­æ³•:</p>

    <p><code class="highlighter-rouge">
 ALTER TABLE table_name MODIFY COLUMN column_name datatype
</code></p>
  </li>
</ol>

<hr />

<h3 id="section-6">æ’å…¥æ•°æ®</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>-(void)addData{
    FMDatabase *db = [FMDatabase databaseWithPath:fileName];
    
    NSDictionary *dic = @{
                          @"code": @0,
                          @"msg": @"success",
                          @"data": @{
                              @"course": @{
                                  @"id": @24,
                                  @"crowdId": @4,
                                  @"ccode": @"KIa8nNpVmc",
                                  @"cname": @"å¥å¥åº·åº·",
                                  @"coverImg": @"http://ocd2lp9uj.bkt.clouddn.com/FaceQ1445612150222.jpg",
                                  @"description": @"æ·‹æ¼“å°½è‡´",
                                  @"speaker": @2,
                                  @"speakerName": @"åˆ˜æ¬£æˆ",
                                  @"speakerHeadIcon": @"http://ocd2lp9uj.bkt.clouddn.com/FaceQ1445612150222.jpg",
                                  @"startTime": @"2016-10-15 11:21:44",
                                  @"endTime": @"2016-10-15 11:26:50",
                                  @"liveStatus": @"2",
                                  @"saveStatus": @"2"
                              }
                          }
                    };
    NSString *json = [self dictionaryToJson:dic];
    
    if ([db open]){
        NSString *insertSql = @"insert into 't_down_course'(courseId,downPath,courseInfo) values(?,?,?)";
        BOOL result = [db executeUpdate:insertSql,[NSString stringWithFormat:@"%d",count],fileName,json];
        if (result){
            DLog(@"æ·»åŠ æ•°æ®æˆåŠŸ");
            [self showAlertWithMessage:@"æ·»åŠ æ•°æ® --- æˆåŠŸ" completion:nil];
        }else{
            DLog(@"æ·»åŠ æ•°æ®å¤±è´¥");
            [self showAlertWithMessage:@"æ·»åŠ æ•°æ® --- å¤±è´¥" completion:nil];
        }
        count++;
        [db close];
    }else{
        [self showAlertWithMessage:@"æ‰“å¼€æ•°æ®åº“ --- å¤±è´¥" completion:nil];
    }
}
</code></pre>
</div>

<p><strong>æ’å…¥æ•°æ®ç±»å‹å¿…é¡»ä¸º<code class="highlighter-rouge">NSObject</code> çš„å­ç±»</strong></p>

<p><strong>åŸºæœ¬ç±»å‹éœ€è¦å°è£…ä¸ºå¯¹åº”çš„åŒ…è£…ç±»</strong></p>

<p><strong>æ”¯æŒå ä½ç¬¦ï¼Œåæ·»åŠ å†æ•°æ®</strong></p>

<h5 id="section-7">æ’å…¥ä¹Ÿæ”¯æŒä»¥å­—å…¸çš„æ–¹å¼</h5>

<div class="highlighter-rouge"><pre class="highlight"><code>NSDictionary *arguments = @{@"identifier": @(identifier), @"name": name, @"date": date, @"comment": comment ?: [NSNull null]};
BOOL success = [db executeUpdate:@"INSERT INTO authors (identifier, name, date, comment) VALUES (:identifier, :name, :date, :comment)" withParameterDictionary:arguments];
if (!success) {
    NSLog(@"error = %@", [db lastErrorMessage]);
}
</code></pre>
</div>

<h5 id="section-8">æ”¯æŒå¯¹äº‹åŠ¡çš„æ§åˆ¶</h5>
<div class="highlighter-rouge"><pre class="highlight"><code>[db open]

[db beginDeferredTransaction];//å¼€å¯äº‹åŠ¡

BOOL result = [db executeUpdate:insertSql,[NSString stringWithFormat:@"%d",count],fileName,json];

if(result){
	[db commit];// æäº¤äº‹åŠ¡
}else{
	[db rollback];// å›æ»šäº‹åŠ¡
}

</code></pre>
</div>

<hr />

<h3 id="section-9">æŸ¥è¯¢æ•°æ®</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>-(void)selectData{
    FMDatabase *db = [FMDatabase databaseWithPath:fileName];
    if ([db open]){
        NSString *selectSql = @"select * from t_down_course";
        FMResultSet * rs = [db executeQuery:selectSql];
        while ([rs next]) {
            int course = [rs intForColumn:@"id"];
            NSString * courseId = [rs stringForColumn:@"courseId"];
            NSString * downPath = [rs stringForColumn:@"downPath"];
            NSString * courseInfo = [rs stringForColumn:@"courseInfo"];

            DLog(@"course id = %d, courseId = %@, downPath = %@  courseInfo = %@", course, courseId, downPath,courseInfo);
            
            NSMutableDictionary *dic = [self dictionaryWithJsonString:courseInfo];
            DLog(@"%@",dic);
        }
        [db close];
    }else{
        [self showAlertWithMessage:@"æ‰“å¼€æ•°æ®åº“ --- å¤±è´¥" completion:nil];
    }
}
</code></pre>
</div>

<p><strong>æ³¨æ„ï¼šå³ä½¿æ“ä½œç»“æœåªæœ‰ä¸€è¡Œï¼Œä¹Ÿéœ€è¦å…ˆè°ƒç”¨ FMResultSet çš„ next æ–¹æ³•ã€‚</strong></p>

<p>FMDBæä¾›äº†å¤šä¸ªæ–¹æ³•è·å–ä¸åŒç±»å‹çš„æ•°æ®</p>

<ul>
  <li>intForColumn:</li>
  <li>longForColumn:</li>
  <li>longLongIntForColumn:</li>
  <li>boolForColumn:</li>
  <li>doubleForColumn:</li>
  <li>stringForColumn:</li>
  <li>dateForColumn:</li>
  <li>dataForColumn:</li>
  <li>dataNoCopyForColumn:</li>
  <li>UTF8StringForColumnIndex:</li>
  <li>objectForColumn:</li>
</ul>

<p><strong>è¿™äº›æ–¹æ³•ä¹Ÿéƒ½æœ‰ä¸€ä¸ª{ç±»å‹} ForColumnIndex:,ç”¨äºæ£€ç´¢æ•°æ®åŸºäºåˆ—çš„ä½ç½®çš„ç»“æœ,è€Œä¸æ˜¯åˆ—çš„åç§°ã€‚</strong></p>

<p>æ¯”å¦‚  <code class="highlighter-rouge">[rs intForColumnIndex:0]</code></p>

<p>æ”¯æŒå¤šä¸ªè¯­å¥æ‰¹å¤„ç†</p>

<div class="highlighter-rouge"><pre class="highlight"><code>NSString *sql = @"create table bulktest1 (id integer primary key autoincrement, x text);"
                 "create table bulktest2 (id integer primary key autoincrement, y text);"
                 "create table bulktest3 (id integer primary key autoincrement, z text);"
                 "insert into bulktest1 (x) values ('XXX');"
                 "insert into bulktest2 (y) values ('YYY');"
                 "insert into bulktest3 (z) values ('ZZZ');";

success = [db executeStatements:sql];

sql = @"select count(*) as count from bulktest1;"
       "select count(*) as count from bulktest2;"
       "select count(*) as count from bulktest3;";

success = [self.db executeStatements:sql withResultBlock:^int(NSDictionary *dictionary) {
    NSInteger count = [dictionary[@"count"] integerValue];
    XCTAssertEqual(count, 1, @"expected one record for dictionary %@", dictionary);
    return 0;
}];
</code></pre>
</div>

<hr />

<h3 id="section-10">æ›´æ–°æ•°æ®</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>-(void)updateData{
    FMDatabase *db = [FMDatabase databaseWithPath:fileName];
    if ([db open]){
        BOOL result = [db executeUpdate:@"update t_down_course set downPath = 'æ›´æ–°çš„æ•°æ®' where id = 3"];
        if (result){
            DLog(@"æ›´æ–°æ•°æ®æˆåŠŸ");
            [self showAlertWithMessage:@"æ›´æ–°æ•°æ® --- æˆåŠŸ" completion:nil];
        }else{
            DLog(@"æ›´æ–°æ•°æ®å¤±è´¥");
            [self showAlertWithMessage:@"æ›´æ–°æ•°æ® --- å¤±è´¥" completion:nil];
        }
        
        [db close];
    }else{
        [self showAlertWithMessage:@"æ‰“å¼€æ•°æ®åº“ --- å¤±è´¥" completion:nil];
    }
}
</code></pre>
</div>

<hr />

<h3 id="section-11">åˆ é™¤æ•°æ®</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>-(void)deleteData{
    FMDatabase *db = [FMDatabase databaseWithPath:fileName];
    if ([db open]){
        BOOL result = [db executeUpdate:@"delete from t_down_course where id = 2"];
        if (result){
            DLog(@"åˆ é™¤æ•°æ®æˆåŠŸ");
            [self showAlertWithMessage:@"åˆ é™¤æ•°æ® --- æˆåŠŸ" completion:nil];
        }else{
            DLog(@"åˆ é™¤æ•°æ®å¤±è´¥");
            [self showAlertWithMessage:@"åˆ é™¤æ•°æ® --- å¤±è´¥" completion:nil];
        }
        
        [db close];
    }else{
        [self showAlertWithMessage:@"æ‰“å¼€æ•°æ®åº“ --- å¤±è´¥" completion:nil];
    }
}
</code></pre>
</div>

<hr />

<h3 id="section-12">åˆ é™¤è¡¨</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>-(void)dropTable{
    FMDatabase *db = [FMDatabase databaseWithPath:fileName];
    if ([db open]){
        BOOL result = [db executeUpdate:@"drop table t_down_course"];
        if (result){
            DLog(@"åˆ é™¤è¡¨æˆåŠŸ");
            isTableExist = NO;
            [self showAlertWithMessage:@"åˆ é™¤è¡¨ --- æˆåŠŸ" completion:nil];
        }else{
            DLog(@"åˆ é™¤è¡¨å¤±è´¥");
            [self showAlertWithMessage:@"åˆ é™¤è¡¨ --- å¤±è´¥" completion:nil];
        }
        
        [db close];
    }else{
        [self showAlertWithMessage:@"æ‰“å¼€æ•°æ®åº“ --- å¤±è´¥" completion:nil];
    }
}
</code></pre>
</div>

<hr />

<h3 id="section-13">å¤šçº¿ç¨‹æ“ä½œ</h3>

<blockquote>
  <p>å¦‚æœåº”ç”¨ä¸­ä½¿ç”¨äº†å¤šçº¿ç¨‹æ“ä½œæ•°æ®åº“ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨FMDatabaseQueueæ¥ä¿è¯çº¿ç¨‹å®‰å…¨äº†ã€‚ åº”ç”¨ä¸­ä¸å¯åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å…±åŒä½¿ç”¨ä¸€ä¸ªFMDatabaseå¯¹è±¡æ“ä½œæ•°æ®åº“ï¼Œè¿™æ ·ä¼šå¼•èµ·æ•°æ®åº“æ•°æ®æ··ä¹±ã€‚ ä¸ºäº†å¤šçº¿ç¨‹æ“ä½œæ•°æ®åº“å®‰å…¨ï¼ŒFMDBä½¿ç”¨äº†FMDatabaseQueueï¼Œä½¿ç”¨FMDatabaseQueueå¾ˆç®€å•ï¼Œé¦–å…ˆç”¨ä¸€ä¸ªæ•°æ®åº“æ–‡ä»¶åœ°å€æ¥åˆä½¿åŒ–FMDatabaseQueueï¼Œç„¶åå°±å¯ä»¥å°†ä¸€ä¸ªé—­åŒ…(block)ä¼ å…¥inDatabaseæ–¹æ³•ä¸­ã€‚ åœ¨é—­åŒ…ä¸­æ“ä½œæ•°æ®åº“ï¼Œè€Œä¸ç›´æ¥å‚ä¸FMDatabaseçš„ç®¡ç†ã€‚</p>
</blockquote>

<h5 id="section-14">åˆ›å»ºå•ä¾‹</h5>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">//
//  XCDatabaseHelper.h
//  Training
//
//  Created by LXC on 2016/12/3.
//  Copyright Â© 2016å¹´ LXC. All rights reserved.
//
</span>
<span class="cp">#import &lt;Foundation/Foundation.h&gt;
#import "FMDB.h"
</span>
<span class="k">@interface</span> <span class="nc">XCDatabaseHelper</span> <span class="p">:</span> <span class="nc">NSObject</span>

<span class="k">+</span> <span class="p">(</span><span class="n">XCDatabaseHelper</span> <span class="o">*</span><span class="p">)</span> <span class="n">sharedInstance</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">inDatabase</span><span class="p">:(</span><span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">FMDatabase</span> <span class="o">*</span><span class="p">))</span><span class="nv">block</span><span class="p">;</span>

<span class="k">@end</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">//
//  XCDatabaseHelper.m
//  Training
//
//  Created by LXC on 2016/12/3.
//  Copyright Â© 2016å¹´ LXC. All rights reserved.
//
</span>
<span class="cp">#import "XCDatabaseHelper.h"
</span>

<span class="k">@implementation</span> <span class="nc">XCDatabaseHelper</span>
<span class="p">{</span>
    <span class="n">FMDatabaseQueue</span><span class="o">*</span> <span class="n">queue</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">-</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">init</span><span class="p">{</span>
    <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">){</span>
        <span class="n">NSString</span> <span class="o">*</span><span class="n">doc</span> <span class="o">=</span><span class="p">[</span><span class="n">NSSearchPathForDirectoriesInDomains</span><span class="p">(</span><span class="n">NSDocumentDirectory</span><span class="p">,</span><span class="n">NSUserDomainMask</span><span class="p">,</span> <span class="nb">YES</span><span class="p">)</span> <span class="nf">lastObject</span><span class="p">];</span>
        <span class="n">NSString</span> <span class="o">*</span><span class="n">dbFilePath</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span> <span class="nf">stringByAppendingPathComponent</span><span class="p">:</span><span class="s">@"downCourse.sqlite"</span><span class="p">];</span>
        <span class="n">queue</span> <span class="o">=</span> <span class="p">[</span><span class="n">FMDatabaseQueue</span> <span class="nf">databaseQueueWithPath</span><span class="p">:</span><span class="n">dbFilePath</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">+</span> <span class="p">(</span><span class="n">XCDatabaseHelper</span> <span class="o">*</span><span class="p">)</span> <span class="n">sharedInstance</span><span class="p">{</span>
    <span class="k">static</span> <span class="n">dispatch_once_t</span> <span class="n">pred</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">__strong</span> <span class="k">static</span> <span class="n">id</span> <span class="n">_sharedObject</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="n">dispatch_once</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pred</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
        <span class="n">_sharedObject</span> <span class="o">=</span> <span class="p">[[</span><span class="n">self</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="n">_sharedObject</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="n">inDatabase</span><span class="o">:</span><span class="p">(</span><span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">FMDatabase</span><span class="o">*</span><span class="p">))</span><span class="n">block</span><span class="p">{</span>
    <span class="p">[</span><span class="n">queue</span> <span class="nf">inDatabase</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">FMDatabase</span> <span class="o">*</span><span class="n">db</span><span class="p">){</span>
        <span class="n">block</span><span class="p">(</span><span class="n">db</span><span class="p">);</span>
    <span class="p">}];</span>
<span class="p">}</span>

<span class="k">@end</span>
</code></pre>
</div>

<h5 id="section-15">è°ƒç”¨</h5>
<div class="highlighter-rouge"><pre class="highlight"><code>        [[XCDatabaseHelper sharedInstance] inDatabase:^(FMDatabase *db) {
            BOOL result = [db executeUpdate:@"update t_down_course set downloadStatus = '1' where courseId = ?",_course.ids];
            if (result){

            }
        }];
</code></pre>
</div>

<p>è¿™é‡Œå°±ä¸éœ€è¦ <code class="highlighter-rouge">close</code></p>

<h5 id="section-16">æ³¨æ„</h5>

<blockquote>
  <p>FMDatabaseQueueè™½ç„¶çœ‹ä¼¼ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå®é™…ä¸Šå®ƒæœ¬èº«å¹¶ä¸æ˜¯ï¼Œå®ƒé€šè¿‡å†…éƒ¨åˆ›å»ºä¸€ä¸ªSerialçš„dispatch_queue_tæ¥å¤„ç†é€šè¿‡inDatabaseå’ŒinTransactionä¼ å…¥çš„Blocksï¼Œæ‰€ä»¥å½“æˆ‘ä»¬åœ¨ä¸»çº¿ç¨‹ï¼ˆæˆ–è€…åå°ï¼‰è°ƒç”¨inDatabaseæˆ–è€…inTransactionæ—¶ï¼Œä»£ç å®é™…ä¸Šæ˜¯åŒæ­¥çš„ã€‚FMDatabaseQueueè¿™ä¹ˆè®¾è®¡çš„ç›®çš„æ˜¯è®©æˆ‘ä»¬é¿å…å‘ç”Ÿå¹¶å‘è®¿é—®æ•°æ®åº“çš„é—®é¢˜ï¼Œå› ä¸ºå¯¹æ•°æ®åº“çš„è®¿é—®å¯èƒ½æ˜¯éšæœºçš„ï¼ˆåœ¨ä»»ä½•æ—¶å€™ï¼‰ã€ä¸åŒçº¿ç¨‹é—´ï¼ˆä¸åŒçš„ç½‘ç»œå›è°ƒç­‰ï¼‰çš„è¯·æ±‚ã€‚å†…ç½®ä¸€ä¸ªSerialé˜Ÿåˆ—åï¼ŒFMDatabaseQueueå°±å˜æˆçº¿ç¨‹å®‰å…¨äº†ï¼Œæ‰€æœ‰çš„æ•°æ®åº“è®¿é—®éƒ½æ˜¯åŒæ­¥æ‰§è¡Œï¼Œè€Œä¸”è¿™æ¯”ä½¿ç”¨@synchronizedæˆ–NSLockè¦é«˜æ•ˆå¾—å¤šã€‚</p>
</blockquote>

<blockquote>
  <p>ä½†æ˜¯è¿™ä¹ˆä¸€æ¥å°±æœ‰äº†ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœåå°åœ¨æ‰§è¡Œå¤§é‡çš„æ›´æ–°ï¼Œè€Œä¸»çº¿ç¨‹ä¹Ÿéœ€è¦è®¿é—®æ•°æ®åº“ï¼Œè™½ç„¶è¦è®¿é—®çš„æ•°æ®é‡å¾ˆå°‘ï¼Œä½†æ˜¯åœ¨åå°æ‰§è¡Œå®Œä¹‹å‰ï¼Œè¿˜æ˜¯ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚</p>
</blockquote>

<p>å¼•ç”¨è¿™ç¯‡<a href="http://blog.csdn.net/zhangao0086/article/details/44223007">æ–‡ç« </a></p>

<p>Over~~ æ´—æ¾¡ç¡è§‰ğŸ˜´ğŸ˜´ğŸ˜´</p>
