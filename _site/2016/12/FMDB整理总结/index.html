<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>FMDB æ•´ç†æ€»ç»“</title>
  <meta name="description" content="è¿™å‡ å¤©åœ¨å†™æ–‡ä»¶ä¸‹è½½ï¼Œæ–­ç‚¹ç»­ä¼ ï¼Œéœ€è¦ç”¨åˆ°FMDBè¿›è¡Œæ•°æ®çš„ç®¡ç†ï¼Œç­‰å†™å®Œä¹Ÿæ€»ç»“ä¸€ä¸‹ã€‚">
  <meta name="author" content="lxc">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="FMDB æ•´ç†æ€»ç»“">
  <meta name="twitter:description" content="è¿™å‡ å¤©åœ¨å†™æ–‡ä»¶ä¸‹è½½ï¼Œæ–­ç‚¹ç»­ä¼ ï¼Œéœ€è¦ç”¨åˆ°FMDBè¿›è¡Œæ•°æ®çš„ç®¡ç†ï¼Œç­‰å†™å®Œä¹Ÿæ€»ç»“ä¸€ä¸‹ã€‚">

  <meta property="og:type" content="article">
  <meta property="og:title" content="FMDB æ•´ç†æ€»ç»“">
  <meta property="og:description" content="è¿™å‡ å¤©åœ¨å†™æ–‡ä»¶ä¸‹è½½ï¼Œæ–­ç‚¹ç»­ä¼ ï¼Œéœ€è¦ç”¨åˆ°FMDBè¿›è¡Œæ•°æ®çš„ç®¡ç†ï¼Œç­‰å†™å®Œä¹Ÿæ€»ç»“ä¸€ä¸‹ã€‚">

  <meta name="baidu-site-verification" content="3Qj8KIsSik" />

  <link rel="icon" type="image/png" href="/images/favicon.png" />
  <link href="/images/favicon.png" rel="shortcut icon" type="image/png">

  <link rel="stylesheet" href="/css/main.css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="http://localhost:4000/2016/12/FMDB%E6%95%B4%E7%90%86%E6%80%BB%E7%BB%93/">
  <link rel="alternate" type="application/rss+xml" title="YoRuo:æƒ³å˜å¾—æ›´å¥½" href="http://localhost:4000/feed.xml">

  <meta name="google-site-verification" content="1-1ZlHoRvM0T2FqPbW2S-qLgYXN6rsn52kErlMPd_gw" />

<!-- ç«™ç‚¹ç»Ÿè®¡ -->
  <script
  async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
  </script>

<!-- ç™¾åº¦ç»Ÿè®¡ -->
  

<!-- google ç»Ÿè®¡ -->
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-87669753-2', 'auto');
      ga('send', 'pageview');
  </script>
  

</head>


  <body>

    <span class="mobile btn-mobile-menu">        
      <div class="nav_container">
         <nav class="nav-menu-item" style = "float:right">
            <i class="nav-menu-item">
              <a href="/#blog" title="" class="blog-button">  åšå®¢ä¸»é¡µ
              </a>
            </i>
            
                <i class="nav-menu-item">

                  <a href="/archive" title="archive" class="btn-mobile-menu__icon">
                      æ‰€æœ‰æ–‡ç« 
                  </a>
                </i>
            
                <i class="nav-menu-item">

                  <a href="/tags" title="tags" class="btn-mobile-menu__icon">
                      æ ‡ç­¾
                  </a>
                </i>
            
                <i class="nav-menu-item">

                  <a href="/about" title="about" class="btn-mobile-menu__icon">
                      å…³äºæˆ‘
                  </a>
                </i>
            
          </nav>
      </div>
    </span>
    
    <header class="panel-cover panel-cover--collapsed">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <!-- å¤´åƒæ•ˆæœ-start -->
        <div class="ih-item circle effect right_to_left">
            <a href="/#blog" title="å‰å¾€ YoRuo:æƒ³å˜å¾—æ›´å¥½ çš„ä¸»é¡µ" class="blog-button">
                <div class="img"><img src="/images/avatar.jpg" alt="img"></div>
                <div class="info">
                    <div class="info-back">
                        <h2>
                            
                                YoRuo
                            
                        </h2>
                        <p>
                           
                                Java & iOS
                            
                        </p>
                    </div>
                </div>
            </a>
        </div>
        <!-- å¤´åƒæ•ˆæœ-end -->
        <h1 class="panel-cover__title panel-title"><a href="/#blog" title="link to homepage for YoRuo:æƒ³å˜å¾—æ›´å¥½" class="blog-button">YoRuo:æƒ³å˜å¾—æ›´å¥½</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">çˆ±æŠ˜è…¾ - ä¹äºæŠ˜è…¾ - äº«å—æŠ˜è…¾</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">æ¬¢è¿æ¥åˆ°æˆ‘çš„Blog~</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />

        


        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">åšå®¢ä¸»é¡µ</a></li>
                
                  <li class="navigation__item"><a href="/archive" title="archive">æ‰€æœ‰æ–‡ç« </a></li>
                
                  <li class="navigation__item"><a href="/tags" title="tags">æ ‡ç­¾</a></li>
                
                  <li class="navigation__item"><a href="/about" title="about">å…³äºæˆ‘</a></li>
                
              </ul>
            </nav>
          </div>
        </div>


        </div>
      </div>
    </div>

    
    <div class="panel-cover--overlay cover-disabled"></div>
    
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title">FMDB æ•´ç†æ€»ç»“</h1>
    <div class="post-meta">
      <img src="/images/calendar.png" width="20px"/>
      <time datetime="2016-12-03 23:24:03 +0800" itemprop="datePublished" class="post-meta__date date">2016-12-03</time>

      <span id="busuanzi_container_page_pv"> | é˜…è¯»ï¼š<span id="busuanzi_value_page_pv"></span>æ¬¡</span>
    </p>
    </div>
  </header>


  <section class="post">
    <p>è¿™å‡ å¤©åœ¨å†™æ–‡ä»¶ä¸‹è½½ï¼Œæ–­ç‚¹ç»­ä¼ ï¼Œéœ€è¦ç”¨åˆ°FMDBè¿›è¡Œæ•°æ®çš„ç®¡ç†ï¼Œç­‰å†™å®Œä¹Ÿæ€»ç»“ä¸€ä¸‹ã€‚</p>

<p>å…¶å®ä¹Ÿæ˜¯è¿™ä¸¤å¤©æ‰å­¦ä¹  <code class="highlighter-rouge">FMDB</code>ï¼Œgoogleäº†ä¸€ä¸‹èµ„æ–™æœ‰å¾ˆå¤šï¼Œå°±å» github ä¸Šé¢å…ˆ <a href="https://github.com/ccgus/fmdb">Star</a> ä¸€ä¸‹<code class="highlighter-rouge">FMDB</code>ï¼Œå‘ç°ä»–<code class="highlighter-rouge">README.markdown</code>å†™çš„å¾ˆè¯¦ç»†ã€‚ç„¶åä¹Ÿçœ‹äº†å”å·§å¤§ç‰›çš„<a href="http://blog.devtang.com/2012/04/22/use-fmdb/">æŠ€æœ¯åšå®¢</a>ï¼Œå†™äº†<a href="https://github.com/lxcsjk/FMDBDemo">FMDBDemo</a>ç©ç©ã€‚</p>

<hr />

<h3 id="section">é›†æˆåˆ°é¡¹ç›®</h3>

<p>é€šè¿‡ <a href="https://cocoapods.org">CocoaPods</a> æ·»åŠ  <code class="highlighter-rouge">pod 'FMDB'</code> ç„¶å <code class="highlighter-rouge">pod update --verbose --no-repo-update</code> OK~</p>

<hr />

<h3 id="section-1">åˆ›å»ºæ•°æ®åº“</h3>

<p>å¯¼å…¥ <code class="highlighter-rouge">libsqlite3.tbd</code>  (<code class="highlighter-rouge">libsqlite3.0.tbd</code> ä¹Ÿå¯ä»¥)
<img src="http://oh6uhie7j.bkt.clouddn.com/QQ20161203-223307@2x.png" alt="" /></p>

<p>å¼•å…¥ <code class="highlighter-rouge">#import "FMDB.h"</code></p>

<h5 id="section-2">åˆ›å»ºæ•°æ®åº“</h5>

<div class="highlighter-rouge"><pre class="highlight"><code>    NSString *doc =[NSSearchPathForDirectoriesInDomains(NSDocumentDirectory,NSUserDomainMask, YES) lastObject];
    
    fileName = [doc stringByAppendingPathComponent:@"downCourse.sqlite"];
    
    DLog(@"sqlæ–‡ä»¶è·¯å¾„ ï¼š %@",fileName);
</code></pre>
</div>

<p>æˆ‘åˆ›å»ºåœ¨<code class="highlighter-rouge">Documents</code>ç›®å½•ä¸‹</p>

<p>å…³äºåˆ›å»ºæ•°æ®åº“ï¼š</p>

<blockquote>
  <p>An <code class="highlighter-rouge">FMDatabase</code> is created with a path to a SQLite database file. This path can be one of these three:</p>
</blockquote>

<blockquote>
  <ol>
    <li>A file system path. The file does not have to exist on disk. If it does not exist, it is created for you.</li>
  </ol>
</blockquote>

<blockquote>
  <ol>
    <li>An empty string (@â€â€). An empty database is created at a temporary location. This database is deleted with the <code class="highlighter-rouge">FMDatabase</code> connection is closed.</li>
  </ol>
</blockquote>

<blockquote>
  <ol>
    <li><code class="highlighter-rouge">NULL</code>. An in-memory database is created. This database will be destroyed with the FMDatabase connection is closed.</li>
  </ol>
</blockquote>

<p>æ„æ€å°±æ˜¯</p>

<blockquote>
  <p>å»ºç«‹æ•°æ®åº“åªéœ€è¦å¦‚ä¸‹ä¸€è¡Œå³å¯ , å½“è¯¥æ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼Œfmdb ä¼šè‡ªå·±åˆ›å»ºä¸€ä¸ªã€‚å¦‚æœä½ ä¼ å…¥çš„å‚æ•°æ˜¯ç©ºä¸²ï¼š@â€â€ ï¼Œåˆ™ fmdb ä¼šåœ¨ä¸´æ—¶æ–‡ä»¶ç›®å½•ä¸‹åˆ›å»ºè¿™ä¸ªæ•°æ®åº“ï¼Œå¦‚æœä½ ä¼ å…¥çš„å‚æ•°æ˜¯ NULLï¼Œåˆ™å®ƒä¼šå»ºç«‹ä¸€ä¸ªåœ¨å†…å­˜ä¸­çš„æ•°æ®åº“ã€‚</p>
</blockquote>

<hr />

<h3 id="section-3">æ‰“å¼€æ•°æ®åº“</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>    FMDatabase *db = [FMDatabase databaseWithPath:fileName];
    if ([db open]){
    	// sql
    }
    [db close];
</code></pre>
</div>

<p>å°±å¯ä»¥äº† æ‰§è¡Œå®Œ æ³¨æ„ä¸€å®šè¦ <code class="highlighter-rouge">[db close]</code> å…³é—­æ•°æ®åº“</p>

<hr />

<h3 id="section-4">åˆ›å»ºè¡¨</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>-(void)createTable{
    //    NSFileManager * fileManager = [NSFileManager defaultManager];
    //    if ([fileManager fileExistsAtPath:fileName] == NO) {
    if (!isTableExist) {
        FMDatabase *db = [FMDatabase databaseWithPath:fileName];
        if ([db open]){
            //  åˆ›å»ºè¡¨
            BOOL result = [db executeUpdate:@"CREATE TABLE 't_down_course' ('id' INTEGER PRIMARY KEY AUTOINCREMENT  NOT NULL , 'courseId' INTEGER, 'downPath' VARCHAR(255),'courseInfo' text)"];
            if (result){
                DLog(@"åˆ›å»ºè¡¨æˆåŠŸ");
                isTableExist = YES;
                [self showAlertWithMessage:@"åˆ›å»ºè¡¨ --- æˆåŠŸ" completion:nil];
            }else{
                [self showAlertWithMessage:@"åˆ›å»ºè¡¨ --- å¤±è´¥" completion:nil];
            }
            [db close];
        }else{
            [self showAlertWithMessage:@"æ‰“å¼€æ•°æ®åº“ --- å¤±è´¥" completion:nil];
        }
    }
    //    }
}
</code></pre>
</div>

<p>åˆ›å»ºåç§°ä¸º <code class="highlighter-rouge">t_down_course</code> çš„è¡¨</p>

<h5 id="section-5">å¯¹è¡¨çš„å±æ€§æ€åˆ æ”¹</h5>

<p>è¯­æ³•:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>BOOL result = [db executeUpdate:sql]
</code></pre>
</div>

<ol>
  <li>
    <p>å¦‚éœ€åœ¨è¡¨ä¸­æ·»åŠ åˆ—ï¼Œè¯·ä½¿ç”¨ä¸‹åˆ—è¯­æ³•:</p>

    <p><code class="highlighter-rouge">
 ALTER TABLE table_name ADD column_name datatype
</code></p>
  </li>
  <li>
    <p>è¦åˆ é™¤è¡¨ä¸­çš„åˆ—ï¼Œè¯·ä½¿ç”¨ä¸‹åˆ—è¯­æ³•:</p>

    <p><code class="highlighter-rouge">
 ALTER TABLE table_name DROP COLUMN column_name
</code></p>
  </li>
  <li>
    <p>æ›´æ–°è¡¨ä¸­åˆ—çš„å±æ€§ï¼Œè¯·ä½¿ç”¨ä¸‹åˆ—è¯­æ³•:</p>

    <p><code class="highlighter-rouge">
 ALTER TABLE table_name MODIFY COLUMN column_name datatype
</code></p>
  </li>
</ol>

<hr />

<h3 id="section-6">æ’å…¥æ•°æ®</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>-(void)addData{
    FMDatabase *db = [FMDatabase databaseWithPath:fileName];
    
    NSDictionary *dic = @{
                          @"code": @0,
                          @"msg": @"success",
                          @"data": @{
                              @"course": @{
                                  @"id": @24,
                                  @"crowdId": @4,
                                  @"ccode": @"KIa8nNpVmc",
                                  @"cname": @"å¥å¥åº·åº·",
                                  @"coverImg": @"http://ocd2lp9uj.bkt.clouddn.com/FaceQ1445612150222.jpg",
                                  @"description": @"æ·‹æ¼“å°½è‡´",
                                  @"speaker": @2,
                                  @"speakerName": @"åˆ˜æ¬£æˆ",
                                  @"speakerHeadIcon": @"http://ocd2lp9uj.bkt.clouddn.com/FaceQ1445612150222.jpg",
                                  @"startTime": @"2016-10-15 11:21:44",
                                  @"endTime": @"2016-10-15 11:26:50",
                                  @"liveStatus": @"2",
                                  @"saveStatus": @"2"
                              }
                          }
                    };
    NSString *json = [self dictionaryToJson:dic];
    
    if ([db open]){
        NSString *insertSql = @"insert into 't_down_course'(courseId,downPath,courseInfo) values(?,?,?)";
        BOOL result = [db executeUpdate:insertSql,[NSString stringWithFormat:@"%d",count],fileName,json];
        if (result){
            DLog(@"æ·»åŠ æ•°æ®æˆåŠŸ");
            [self showAlertWithMessage:@"æ·»åŠ æ•°æ® --- æˆåŠŸ" completion:nil];
        }else{
            DLog(@"æ·»åŠ æ•°æ®å¤±è´¥");
            [self showAlertWithMessage:@"æ·»åŠ æ•°æ® --- å¤±è´¥" completion:nil];
        }
        count++;
        [db close];
    }else{
        [self showAlertWithMessage:@"æ‰“å¼€æ•°æ®åº“ --- å¤±è´¥" completion:nil];
    }
}
</code></pre>
</div>

<p><strong>æ’å…¥æ•°æ®ç±»å‹å¿…é¡»ä¸º<code class="highlighter-rouge">NSObject</code> çš„å­ç±»</strong></p>

<p><strong>åŸºæœ¬ç±»å‹éœ€è¦å°è£…ä¸ºå¯¹åº”çš„åŒ…è£…ç±»</strong></p>

<p><strong>æ”¯æŒå ä½ç¬¦ï¼Œåæ·»åŠ å†æ•°æ®</strong></p>

<h5 id="section-7">æ’å…¥ä¹Ÿæ”¯æŒä»¥å­—å…¸çš„æ–¹å¼</h5>

<div class="highlighter-rouge"><pre class="highlight"><code>NSDictionary *arguments = @{@"identifier": @(identifier), @"name": name, @"date": date, @"comment": comment ?: [NSNull null]};
BOOL success = [db executeUpdate:@"INSERT INTO authors (identifier, name, date, comment) VALUES (:identifier, :name, :date, :comment)" withParameterDictionary:arguments];
if (!success) {
    NSLog(@"error = %@", [db lastErrorMessage]);
}
</code></pre>
</div>

<h5 id="section-8">æ”¯æŒå¯¹äº‹åŠ¡çš„æ§åˆ¶</h5>
<div class="highlighter-rouge"><pre class="highlight"><code>[db open]

[db beginDeferredTransaction];//å¼€å¯äº‹åŠ¡

BOOL result = [db executeUpdate:insertSql,[NSString stringWithFormat:@"%d",count],fileName,json];

if(result){
	[db commit];// æäº¤äº‹åŠ¡
}else{
	[db rollback];// å›æ»šäº‹åŠ¡
}

</code></pre>
</div>

<hr />

<h3 id="section-9">æŸ¥è¯¢æ•°æ®</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>-(void)selectData{
    FMDatabase *db = [FMDatabase databaseWithPath:fileName];
    if ([db open]){
        NSString *selectSql = @"select * from t_down_course";
        FMResultSet * rs = [db executeQuery:selectSql];
        while ([rs next]) {
            int course = [rs intForColumn:@"id"];
            NSString * courseId = [rs stringForColumn:@"courseId"];
            NSString * downPath = [rs stringForColumn:@"downPath"];
            NSString * courseInfo = [rs stringForColumn:@"courseInfo"];

            DLog(@"course id = %d, courseId = %@, downPath = %@  courseInfo = %@", course, courseId, downPath,courseInfo);
            
            NSMutableDictionary *dic = [self dictionaryWithJsonString:courseInfo];
            DLog(@"%@",dic);
        }
        [db close];
    }else{
        [self showAlertWithMessage:@"æ‰“å¼€æ•°æ®åº“ --- å¤±è´¥" completion:nil];
    }
}
</code></pre>
</div>

<p><strong>æ³¨æ„ï¼šå³ä½¿æ“ä½œç»“æœåªæœ‰ä¸€è¡Œï¼Œä¹Ÿéœ€è¦å…ˆè°ƒç”¨ FMResultSet çš„ next æ–¹æ³•ã€‚</strong></p>

<p>FMDBæä¾›äº†å¤šä¸ªæ–¹æ³•è·å–ä¸åŒç±»å‹çš„æ•°æ®</p>

<ul>
  <li>intForColumn:</li>
  <li>longForColumn:</li>
  <li>longLongIntForColumn:</li>
  <li>boolForColumn:</li>
  <li>doubleForColumn:</li>
  <li>stringForColumn:</li>
  <li>dateForColumn:</li>
  <li>dataForColumn:</li>
  <li>dataNoCopyForColumn:</li>
  <li>UTF8StringForColumnIndex:</li>
  <li>objectForColumn:</li>
</ul>

<p><strong>è¿™äº›æ–¹æ³•ä¹Ÿéƒ½æœ‰ä¸€ä¸ª{ç±»å‹} ForColumnIndex:,ç”¨äºæ£€ç´¢æ•°æ®åŸºäºåˆ—çš„ä½ç½®çš„ç»“æœ,è€Œä¸æ˜¯åˆ—çš„åç§°ã€‚</strong></p>

<p>æ¯”å¦‚  <code class="highlighter-rouge">[rs intForColumnIndex:0]</code></p>

<p>æ”¯æŒå¤šä¸ªè¯­å¥æ‰¹å¤„ç†</p>

<div class="highlighter-rouge"><pre class="highlight"><code>NSString *sql = @"create table bulktest1 (id integer primary key autoincrement, x text);"
                 "create table bulktest2 (id integer primary key autoincrement, y text);"
                 "create table bulktest3 (id integer primary key autoincrement, z text);"
                 "insert into bulktest1 (x) values ('XXX');"
                 "insert into bulktest2 (y) values ('YYY');"
                 "insert into bulktest3 (z) values ('ZZZ');";

success = [db executeStatements:sql];

sql = @"select count(*) as count from bulktest1;"
       "select count(*) as count from bulktest2;"
       "select count(*) as count from bulktest3;";

success = [self.db executeStatements:sql withResultBlock:^int(NSDictionary *dictionary) {
    NSInteger count = [dictionary[@"count"] integerValue];
    XCTAssertEqual(count, 1, @"expected one record for dictionary %@", dictionary);
    return 0;
}];
</code></pre>
</div>

<hr />

<h3 id="section-10">æ›´æ–°æ•°æ®</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>-(void)updateData{
    FMDatabase *db = [FMDatabase databaseWithPath:fileName];
    if ([db open]){
        BOOL result = [db executeUpdate:@"update t_down_course set downPath = 'æ›´æ–°çš„æ•°æ®' where id = 3"];
        if (result){
            DLog(@"æ›´æ–°æ•°æ®æˆåŠŸ");
            [self showAlertWithMessage:@"æ›´æ–°æ•°æ® --- æˆåŠŸ" completion:nil];
        }else{
            DLog(@"æ›´æ–°æ•°æ®å¤±è´¥");
            [self showAlertWithMessage:@"æ›´æ–°æ•°æ® --- å¤±è´¥" completion:nil];
        }
        
        [db close];
    }else{
        [self showAlertWithMessage:@"æ‰“å¼€æ•°æ®åº“ --- å¤±è´¥" completion:nil];
    }
}
</code></pre>
</div>

<hr />

<h3 id="section-11">åˆ é™¤æ•°æ®</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>-(void)deleteData{
    FMDatabase *db = [FMDatabase databaseWithPath:fileName];
    if ([db open]){
        BOOL result = [db executeUpdate:@"delete from t_down_course where id = 2"];
        if (result){
            DLog(@"åˆ é™¤æ•°æ®æˆåŠŸ");
            [self showAlertWithMessage:@"åˆ é™¤æ•°æ® --- æˆåŠŸ" completion:nil];
        }else{
            DLog(@"åˆ é™¤æ•°æ®å¤±è´¥");
            [self showAlertWithMessage:@"åˆ é™¤æ•°æ® --- å¤±è´¥" completion:nil];
        }
        
        [db close];
    }else{
        [self showAlertWithMessage:@"æ‰“å¼€æ•°æ®åº“ --- å¤±è´¥" completion:nil];
    }
}
</code></pre>
</div>

<hr />

<h3 id="section-12">åˆ é™¤è¡¨</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>-(void)dropTable{
    FMDatabase *db = [FMDatabase databaseWithPath:fileName];
    if ([db open]){
        BOOL result = [db executeUpdate:@"drop table t_down_course"];
        if (result){
            DLog(@"åˆ é™¤è¡¨æˆåŠŸ");
            isTableExist = NO;
            [self showAlertWithMessage:@"åˆ é™¤è¡¨ --- æˆåŠŸ" completion:nil];
        }else{
            DLog(@"åˆ é™¤è¡¨å¤±è´¥");
            [self showAlertWithMessage:@"åˆ é™¤è¡¨ --- å¤±è´¥" completion:nil];
        }
        
        [db close];
    }else{
        [self showAlertWithMessage:@"æ‰“å¼€æ•°æ®åº“ --- å¤±è´¥" completion:nil];
    }
}
</code></pre>
</div>

<hr />

<h3 id="section-13">å¤šçº¿ç¨‹æ“ä½œ</h3>

<blockquote>
  <p>å¦‚æœåº”ç”¨ä¸­ä½¿ç”¨äº†å¤šçº¿ç¨‹æ“ä½œæ•°æ®åº“ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨FMDatabaseQueueæ¥ä¿è¯çº¿ç¨‹å®‰å…¨äº†ã€‚ åº”ç”¨ä¸­ä¸å¯åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å…±åŒä½¿ç”¨ä¸€ä¸ªFMDatabaseå¯¹è±¡æ“ä½œæ•°æ®åº“ï¼Œè¿™æ ·ä¼šå¼•èµ·æ•°æ®åº“æ•°æ®æ··ä¹±ã€‚ ä¸ºäº†å¤šçº¿ç¨‹æ“ä½œæ•°æ®åº“å®‰å…¨ï¼ŒFMDBä½¿ç”¨äº†FMDatabaseQueueï¼Œä½¿ç”¨FMDatabaseQueueå¾ˆç®€å•ï¼Œé¦–å…ˆç”¨ä¸€ä¸ªæ•°æ®åº“æ–‡ä»¶åœ°å€æ¥åˆä½¿åŒ–FMDatabaseQueueï¼Œç„¶åå°±å¯ä»¥å°†ä¸€ä¸ªé—­åŒ…(block)ä¼ å…¥inDatabaseæ–¹æ³•ä¸­ã€‚ åœ¨é—­åŒ…ä¸­æ“ä½œæ•°æ®åº“ï¼Œè€Œä¸ç›´æ¥å‚ä¸FMDatabaseçš„ç®¡ç†ã€‚</p>
</blockquote>

<h5 id="section-14">åˆ›å»ºå•ä¾‹</h5>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">//
//  XCDatabaseHelper.h
//  Training
//
//  Created by LXC on 2016/12/3.
//  Copyright Â© 2016å¹´ LXC. All rights reserved.
//
</span>
<span class="cp">#import &lt;Foundation/Foundation.h&gt;
#import "FMDB.h"
</span>
<span class="k">@interface</span> <span class="nc">XCDatabaseHelper</span> <span class="p">:</span> <span class="nc">NSObject</span>

<span class="k">+</span> <span class="p">(</span><span class="n">XCDatabaseHelper</span> <span class="o">*</span><span class="p">)</span> <span class="n">sharedInstance</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">inDatabase</span><span class="p">:(</span><span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">FMDatabase</span> <span class="o">*</span><span class="p">))</span><span class="nv">block</span><span class="p">;</span>

<span class="k">@end</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">//
//  XCDatabaseHelper.m
//  Training
//
//  Created by LXC on 2016/12/3.
//  Copyright Â© 2016å¹´ LXC. All rights reserved.
//
</span>
<span class="cp">#import "XCDatabaseHelper.h"
</span>

<span class="k">@implementation</span> <span class="nc">XCDatabaseHelper</span>
<span class="p">{</span>
    <span class="n">FMDatabaseQueue</span><span class="o">*</span> <span class="n">queue</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">-</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">init</span><span class="p">{</span>
    <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">){</span>
        <span class="n">NSString</span> <span class="o">*</span><span class="n">doc</span> <span class="o">=</span><span class="p">[</span><span class="n">NSSearchPathForDirectoriesInDomains</span><span class="p">(</span><span class="n">NSDocumentDirectory</span><span class="p">,</span><span class="n">NSUserDomainMask</span><span class="p">,</span> <span class="nb">YES</span><span class="p">)</span> <span class="nf">lastObject</span><span class="p">];</span>
        <span class="n">NSString</span> <span class="o">*</span><span class="n">dbFilePath</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span> <span class="nf">stringByAppendingPathComponent</span><span class="p">:</span><span class="s">@"downCourse.sqlite"</span><span class="p">];</span>
        <span class="n">queue</span> <span class="o">=</span> <span class="p">[</span><span class="n">FMDatabaseQueue</span> <span class="nf">databaseQueueWithPath</span><span class="p">:</span><span class="n">dbFilePath</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">+</span> <span class="p">(</span><span class="n">XCDatabaseHelper</span> <span class="o">*</span><span class="p">)</span> <span class="n">sharedInstance</span><span class="p">{</span>
    <span class="k">static</span> <span class="n">dispatch_once_t</span> <span class="n">pred</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">__strong</span> <span class="k">static</span> <span class="n">id</span> <span class="n">_sharedObject</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="n">dispatch_once</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pred</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
        <span class="n">_sharedObject</span> <span class="o">=</span> <span class="p">[[</span><span class="n">self</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="n">_sharedObject</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="n">inDatabase</span><span class="o">:</span><span class="p">(</span><span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">FMDatabase</span><span class="o">*</span><span class="p">))</span><span class="n">block</span><span class="p">{</span>
    <span class="p">[</span><span class="n">queue</span> <span class="nf">inDatabase</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">FMDatabase</span> <span class="o">*</span><span class="n">db</span><span class="p">){</span>
        <span class="n">block</span><span class="p">(</span><span class="n">db</span><span class="p">);</span>
    <span class="p">}];</span>
<span class="p">}</span>

<span class="k">@end</span>
</code></pre>
</div>

<h5 id="section-15">è°ƒç”¨</h5>
<div class="highlighter-rouge"><pre class="highlight"><code>        [[XCDatabaseHelper sharedInstance] inDatabase:^(FMDatabase *db) {
            BOOL result = [db executeUpdate:@"update t_down_course set downloadStatus = '1' where courseId = ?",_course.ids];
            if (result){

            }
        }];
</code></pre>
</div>

<p>è¿™é‡Œå°±ä¸éœ€è¦ <code class="highlighter-rouge">close</code></p>

<h5 id="section-16">æ³¨æ„</h5>

<blockquote>
  <p>FMDatabaseQueueè™½ç„¶çœ‹ä¼¼ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå®é™…ä¸Šå®ƒæœ¬èº«å¹¶ä¸æ˜¯ï¼Œå®ƒé€šè¿‡å†…éƒ¨åˆ›å»ºä¸€ä¸ªSerialçš„dispatch_queue_tæ¥å¤„ç†é€šè¿‡inDatabaseå’ŒinTransactionä¼ å…¥çš„Blocksï¼Œæ‰€ä»¥å½“æˆ‘ä»¬åœ¨ä¸»çº¿ç¨‹ï¼ˆæˆ–è€…åå°ï¼‰è°ƒç”¨inDatabaseæˆ–è€…inTransactionæ—¶ï¼Œä»£ç å®é™…ä¸Šæ˜¯åŒæ­¥çš„ã€‚FMDatabaseQueueè¿™ä¹ˆè®¾è®¡çš„ç›®çš„æ˜¯è®©æˆ‘ä»¬é¿å…å‘ç”Ÿå¹¶å‘è®¿é—®æ•°æ®åº“çš„é—®é¢˜ï¼Œå› ä¸ºå¯¹æ•°æ®åº“çš„è®¿é—®å¯èƒ½æ˜¯éšæœºçš„ï¼ˆåœ¨ä»»ä½•æ—¶å€™ï¼‰ã€ä¸åŒçº¿ç¨‹é—´ï¼ˆä¸åŒçš„ç½‘ç»œå›è°ƒç­‰ï¼‰çš„è¯·æ±‚ã€‚å†…ç½®ä¸€ä¸ªSerialé˜Ÿåˆ—åï¼ŒFMDatabaseQueueå°±å˜æˆçº¿ç¨‹å®‰å…¨äº†ï¼Œæ‰€æœ‰çš„æ•°æ®åº“è®¿é—®éƒ½æ˜¯åŒæ­¥æ‰§è¡Œï¼Œè€Œä¸”è¿™æ¯”ä½¿ç”¨@synchronizedæˆ–NSLockè¦é«˜æ•ˆå¾—å¤šã€‚</p>
</blockquote>

<blockquote>
  <p>ä½†æ˜¯è¿™ä¹ˆä¸€æ¥å°±æœ‰äº†ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœåå°åœ¨æ‰§è¡Œå¤§é‡çš„æ›´æ–°ï¼Œè€Œä¸»çº¿ç¨‹ä¹Ÿéœ€è¦è®¿é—®æ•°æ®åº“ï¼Œè™½ç„¶è¦è®¿é—®çš„æ•°æ®é‡å¾ˆå°‘ï¼Œä½†æ˜¯åœ¨åå°æ‰§è¡Œå®Œä¹‹å‰ï¼Œè¿˜æ˜¯ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚</p>
</blockquote>

<p>å¼•ç”¨è¿™ç¯‡<a href="http://blog.csdn.net/zhangao0086/article/details/44223007">æ–‡ç« </a></p>

<p>Over~~ æ´—æ¾¡ç¡è§‰ğŸ˜´ğŸ˜´ğŸ˜´</p>


  </section>

  <section class="post-comments">
    <div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
    <script src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script>
    <script>
    var cloudTieConfig = {
      url: document.location.href,
      productKey: "673e3a654fa741b5a57a102ca11ef35c",
      target: "cloud-tie-wrapper"
    };
    var yunManualLoad = true;
    Tie.loader("aHR0cHM6Ly9hcGkuZ2VudGllLjE2My5jb20vcGMvbGl2ZXNjcmlwdC5odG1s", true);
    </script>
  </section>

</article>


<section>
       <ul class="pager">
        
        <li class="previous">
            <a href="/2016/11/Doesn't-include-the-currently-selected-devic/" data-toggle="tooltip" data-placement="top" title="Doesn't include the currently selected device ">ä¸Šä¸€ç¯‡ï¼š  <span>Doesn't include the currently selected device </span>
            </a>
        </li>
        
        
        <li class="next">
            <a href="/2016/12/Mac%E6%9B%B4%E6%96%B010.12%E5%90%8E%E5%85%B3%E6%9C%BA%E5%BE%88%E6%85%A2%E7%9A%84%E9%97%AE%E9%A2%98/" data-toggle="tooltip" data-placement="top" title="Macæ›´æ–°10.12åå…³æœºå¾ˆæ…¢çš„é—®é¢˜">ä¸‹ä¸€ç¯‡ï¼š  <span>Macæ›´æ–°10.12åå…³æœºå¾ˆæ…¢çš„é—®é¢˜</span>
            </a>
        </li>
        
    </ul>
</section>

<!-- <section class="post-comments">

</section>
 -->

            <section class="footer">
    <footer>
        <div class = "footer_div">  
        <nav class="cover-navigation navigation--social">
          <ul class="navigation">

          
          <!-- Weibo -->
          <li class="navigation__item_social">
            <a href="http://weibo.com/GrazyLXC" title="@GrazyLXC çš„å¾®åš" target="_blank">
              <i class='social fa fa-weibo fa-2x'></i>
              <span class="label">Weibo</span>
            </a>
          </li>
          

          
          <!-- Github -->
          <li class="navigation__item_social">
            <a href="https://github.com/lxcsjk" title="@lxcsjk çš„ Github" target="_blank">
              <i class='social fa fa-github fa-2x'></i>
              <span class="label">Github</span>
            </a>
          </li>
          
          
          

          

          <!-- RSS -->
          <li class="navigation__item_social">
            <a href="/feed.xml" rel="author" title="RSS" target="_blank">
              <i class='social fa fa-rss fa-2x'></i>
              <span class="label">RSS</span>
            </a>
          </li>

          
          <!-- Email -->
          <li class="navigation__item_social">
            <a href="mailto:yoruolxc@outlook.com" title="Contact me">
              <i class='social fa fa-envelope fa-2x'></i>
              <span class="label">Email</span>
            </a>
          </li>
          

          </ul>
        </nav>

        </div>

        <div class = "footer_div">  
           <p class="copyright text-muted">
            Copyright &copy; YoRuo:æƒ³å˜å¾—æ›´å¥½ 2017 Theme by <a href="http://baixin.io/">leopardpan</a> |
            <iframe
                style="margin-left: 2px; margin-bottom:-5px;"
                frameborder="0" scrolling="0" width="91px" height="20px"
                src="https://ghbtns.com/github-btn.html?user=leopardpan&repo=leopardpan.github.io&type=star&count=true" >
            </iframe>
            </p>
        	<div align="right">
    			<link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">

          <!-- è®¿é—®ç»Ÿè®¡ -->
          <span id="busuanzi_container_site_pv">
            æœ¬ç«™æ€»è®¿é—®é‡
            <span id="busuanzi_value_site_pv"></span>æ¬¡
          </span>

        </div>
        <div>
    </footer>
</section>

        </div>
    </div>
    
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>
<script type="text/javascript" src="/js/highlight.pack.js"></script>
<!-- <script type="text/javascript" src="http://meet.xpro.im/v2/api/xmeet.api.js"></script> -->
<script>hljs.initHighlightingOnLoad();</script>


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?3faa942a6a653accc643509d0c44b314";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?41e6519316b78acb0f86b69b1ca93bc2";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-87669753-2', 'auto');
  ga('send', 'pageview');

</script>
    
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-87669753-1', 'auto');
  ga('send', 'pageview');

</script>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
    

  </body>

</html>
